<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Custom Page</title>
</head>
<body>
    <h1>Welcome to My Raspberry Pi Web Page</h1>
    <p>This is a custom HTML page served by my Raspberry Pi.</p>
    <div id="chartDiv" style="width: 100%; height: 500px;"></div>

    <!-- Include SciChart.js via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/scichart/index.min.js" crossorigin="anonymous"></script>    

    <script type="module">
    // Access the necessary types from SciChart
    const { 
        SciChartSurface,
        NumericAxis,
        FastLineRenderableSeries,
        XyDataSeries,
        EllipsePointMarker,
        SweepAnimation,
        SciChartJsNavyTheme,
        NumberRange,
        MouseWheelZoomModifier,
        ZoomPanModifier,
        ZoomExtentsModifier
    } = SciChart;

    async function init() {
        const { sciChartSurface, wasmContext } = await SciChartSurface.create("chartDiv");

        // Add axes
        sciChartSurface.xAxes.add(new NumericAxis(wasmContext));
        sciChartSurface.yAxes.add(new NumericAxis(wasmContext));

        // Create a line series and add data
        const series = new FastLineRenderableSeries(wasmContext, { stroke: "red" });
        const dataSeries = new XyDataSeries(wasmContext);
        dataSeries.append(0, 0);
        dataSeries.append(1, 1);
        dataSeries.append(2, 4);
        dataSeries.append(3, 9);
        series.dataSeries = dataSeries;

        // Add series to the chart
        sciChartSurface.renderableSeries.add(series);

        // Optionally, apply modifiers (zooming, panning, etc.)
        sciChartSurface.chartModifiers.add(new MouseWheelZoomModifier());
        sciChartSurface.chartModifiers.add(new ZoomPanModifier());
        sciChartSurface.chartModifiers.add(new ZoomExtentsModifier());
    }

	// WebSocket setup
    const socket = new WebSocket('ws://localhost:8765'); // Replace with your server IP if not local

    socket.onmessage = function(event) {
        const data = JSON.parse(event.data); // Parse the incoming JSON data

        // Add new data to the chart (append to the data series)
        dataSeries.clear();
        dataSeries.append(data.x, data.y);

        // Optionally, update the chart's range if needed
        // sciChartSurface.zoomExtents();
    };

    socket.onopen = function() {
        console.log('WebSocket connection established');
    };

    socket.onerror = function(error) {
        console.log('WebSocket error: ', error);
    };

    socket.onclose = function() {
        console.log('WebSocket connection closed');
    };

    window.onload = init;
</script>
</body>
</html>
